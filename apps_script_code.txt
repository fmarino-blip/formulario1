// Apps Script para recibir datos del formulario y guardarlos en Google Sheets
// Reemplaza SPREADSHEET_ID si fuera necesario (ya configurado con tu hoja)

const SPREADSHEET_ID = '1KqHdSxmnpfCZMKzeQCVXCXBdAL88IEPKW2xNapaabMc';
const SHEET_NAME = 'Sheet1'; // Cambia si tu pestaña tiene otro nombre

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents || '{}');

    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = ss.getSheetByName(SHEET_NAME) || ss.getSheets()[0];

    // Ajusta el orden según los encabezados de tu hoja
    sheet.appendRow([
      data.equipo || '',
      data.encargado || '',
      data.especialidad || '',
      data.celular || '',
      data.dni || '',
      data.email || '',
      data.discord || '',
      data.estudiante || '',
      data.numIntegrantes || '',
      data.integrantes || '',
      data.juego || '',
      data.campo1 || '',
      data.campo2 || '',
      new Date()
    ]);

    // Envío de correo de confirmación (opcional)
    if (data.email) {
      const subject = 'Gracias por tu inscripción';
      const body = `Hola ${data.encargado || ''},\n\nGracias por inscribir tu equipo "${data.equipo || ''}" en el torneo.\n\nRecibimos tu inscripción correctamente.\n\n¡Éxitos!\nEquipo del Torneo`;
      MailApp.sendEmail(data.email, subject, body);
    }

    return ContentService
      .createTextOutput(JSON.stringify({ success: true }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ success: false, error: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Opcional: doGet para pruebas desde navegador
function doGet(e) {
  return ContentService
    .createTextOutput(JSON.stringify({ success: true, msg: 'Apps Script funcionando' }))
    .setMimeType(ContentService.MimeType.JSON);
}

/*
Instrucciones de despliegue:
1. Abre la Google Sheet indicada.
2. Ve a Extensiones -> Apps Script.
3. Pega este código reemplazando cualquier código existente.
4. Guardar.
5. Implementar -> Nueva implementación -> Tipo: Aplicación web.
   - Ejecutar como: Tu cuenta (tu correo)
   - Quién tiene acceso: "Cualquiera" o "Cualquiera, incluso anónimo" (para permitir POST desde la web sin credenciales)
6. Autoriza permisos cuando se soliciten (acceso a Sheets y Mail).
7. Copia la URL de despliegue (termina en /exec) y pégala en tu `formulario.html` reemplazando el placeholder:
   const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec";

Notas:
- Asegúrate que la primera fila de la hoja contenga los encabezados:
  Equipo | Encargado | Especialidad | Celular | DNI | Email | Discord | Estudiante | NumIntegrantes | Integrantes | Juego | Campo1 | Campo2 | Fecha
- Si quieres que yo inserte la URL en tu `formulario.html`, pégala aquí y la actualizo por ti.
*/